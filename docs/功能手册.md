# Conlang Maker 功能手册

> 版本：v0.3 (Phase 3)  
> Conlang Maker 是一款桌面端人工语言（Conlang）全流程创作工具，涵盖音系定义、词典管理、语法建模、音变推演、语料标注、语言派生到多格式导出的完整工作流。

---

## 目录

1. [词典](#1-词典-lexicon)
2. [音系](#2-音系-phonology)
3. [语法](#3-语法-grammar)
4. [翻译沙盒](#4-翻译沙盒-sandbox)
5. [造词生成器](#5-造词生成器-word-generator)
6. [词典质检](#6-词典质检-quality-check)
7. [统计报告](#7-统计报告-statistics)
8. [历时音变引擎](#8-历时音变引擎-sca)
9. [语料库](#9-语料库-corpus)
10. [语系树](#10-语系树-family-tree)
11. [导出与导入](#11-导出与导入-export--import)
12. [快速录入](#12-快速录入-quick-entry)

---

## 1. 词典 (Lexicon)

核心模块，以侧边栏 + 编辑面板的分栏布局管理所有词条。

### 1.1 词条管理

| 功能 | 说明 |
|------|------|
| 新增词条 | 点击侧边栏 `+` 按钮创建空白词条 |
| 编辑词条 | 右侧面板实时编辑，自动 debounce 保存（500ms） |
| 删除词条 | 编辑面板顶部删除按钮 |
| 搜索 | 按罗马音或释义文本过滤词条列表 |
| IPA 模糊搜索 | 开启 IPA 搜索模式，输入 IPA 按语音相似度排序结果 |
| 标签 | 逗号分隔的自由标签系统 |
| CSV 导出 | 侧边栏一键导出为 CSV |

### 1.2 义项 (Sense)

每个词条支持多个义项，每个义项包含：

- **词性 (POS)** — 从语法模块定义的词性列表中选择
- **简明释义 (Gloss)** — 用于行间标注的简短翻译
- **详细定义** — 多行完整释义
- **例句** — 多行用法示例

### 1.3 IPA 自动生成

- 编辑罗马音时，自动通过罗马音映射表 → 音位变体规则生成 IPA
- 可锁定为手动模式（🔒），自由编写 IPA
- 解锁后（🔓）恢复自动生成

### 1.4 发音播放

点击词条 IPA 旁的 🔊 按钮，通过拼接式 TTS 逐个播放音素音频，完全离线运行。

### 1.5 词源管理

| 来源类型 | 说明 |
|---------|------|
| 先验创造 (A priori) | 凭空创造 |
| 后验创造 (A posteriori) | 参考自然语言 |
| 演变 (Evolved) | 从父语言音变而来 |
| 借词 (Borrowed) | 从其他语言借入 |
| 混合 (Mixed) | 多来源混合 |
| 派生 (Derived) | 通过构词派生 |

每个词源可记录：父词条 ID、源语言 ID、已应用的音变规则、语义转移备注。

---

## 2. 音系 (Phonology)

管理语言的语音系统，包含 4 个子页面。

### 2.1 音素表 (Inventory)

- **交互式 IPA 图表**：辅音表（13 个发音部位 × 13 种发音方式矩阵）、元音梯形图
- **非肺音辅音**：内爆音、挤喉音、搭嘴音独立区域
- **音频播放**：点击任意音素即时播放其 IPA 标准发音（329 个音素音频）
- **预设系统**：12 种真实语言风格预设，一键加载音素集 + 音节结构
  - 日语风、阿拉伯语风、斯拉夫语风、芬兰语风、夏威夷语风、纳瓦特尔语风、普通话风、印地语风、斯瓦希里语风、拉丁语风、格鲁吉亚语风、精灵语风
- **音素表警告**：自动检测不平衡（缺清浊对立、元音/辅音过少等）

### 2.2 罗马音映射 (Romanization)

- **多映射表**：支持创建多套映射表，可设置默认
- **规则定义**：每条规则有「输入」→「输出音素」，可附带上下文环境
- **最长匹配**：自动按输入长度降序排序，贪心优先匹配长序列
- **音素表联动**：点击音素表音素可插入到编辑字段

### 2.3 音位配列 (Phonotactics)

| 功能 | 说明 |
|------|------|
| 音节结构模板 | 如 `(C)V(C)(C)`，大写字母为宏占位，括号表示可选 |
| 音素类宏 | 自定义 macro，如 `C = [p, t, k, s]`，`V = [a, e, i, o, u]` |
| 黑名单 | 正则表达式拒绝非法音节组合 |
| 元音和谐 | 将元音分两组，同一词内不允许混用 |
| 声调系统 | 定义声调类别（名称 + 标记符号） |

### 2.4 音位变体 (Allophony)

- **规则**：目标音素 → 替换音素，可设前置/后置上下文
- **优先级**：按 priority 降序依次应用，首个匹配即停止
- **宏引用**：上下文中可引用音素类宏

---

## 3. 语法 (Grammar)

8 个子区段，管理语法规则的完整生命周期。

### 3.1 句法配置 (Syntax)

- **基本语序**：SVO / SOV / VSO / VOS / OVS / OSV
- **修饰语位置**：中心词前 / 中心词后
- **介词类型**：前置词 / 后置词

### 3.2 词性管理 (POS)

自定义词性来定义语言的词类体系：

- 名称、缩写（用于 Gloss 标注）
- 词形模式（正则表达式）
- 是否要求释义 / 发音

默认提供 8 种基本词性：名词、动词、形容词、副词、代词、介词、连词、感叹词。

### 3.3 屈折规则 (Inflection)

支持 6 种形态操作类型：

| 类型 | 说明 | 示例 |
|------|------|------|
| 前缀 (Prefix) | 词前添加 | un- + happy |
| 后缀 (Suffix) | 词后添加 | cat + -s |
| 中缀 (Infix) | 词中插入 | 在第 N 个音素后插入 |
| 环缀 (Circumfix) | 头尾同时加 | ge- ... -t |
| 重叠 (Reduplication) | 全词/部分重叠 | 完全重叠或首 N 音素 |
| 元音变换 (Ablaut) | 交替元素 | sing → sang |

**条件逻辑**：每条规则支持 IF/ELSE 分支，根据词尾/词首音素类型或正则匹配选择不同词缀。

### 3.4 屈折矩阵 (Matrix)

以矩阵表格形式一览所有词性 × 维度值的屈折范式，快速检查规则覆盖情况。

### 3.5 屈折维度 (Dimensions)

自定义屈折维度及其值：

- **维度示例**：格 (Case)、数 (Number)、时态 (Tense)、人称 (Person)
- **维度值**：每个维度含多个值，如 Case: NOM / ACC / GEN / DAT
- **词性关联**：指定每个维度适用于哪些词性

### 3.6 派生规则 (Derivation)

- **词性转换**：源词性 → 目标词性（如 动词→名词：动作者后缀 -er）
- **复用形态引擎**：所有 6 种形态类型均可用于派生
- **语义说明**：附带语义转移注释
- **批量预览**：对词典中符合条件的词批量预览派生结果
- **一键导入**：将生成的派生词直接导入词典

### 3.7 语法手册 (Manual)

- **Markdown 章节**：有序章节列表，每章含标题 + Markdown 正文
- **嵌入范式表**：在 Markdown 中使用 `{{paradigm:pos_id:测试词}}` 语法嵌入动态屈折范式表
- **拖拽排序**：章节可自由调整顺序

### 3.8 屈折测试 (Test)

输入一个测试词 + 选择词性 → 立即运行所有适用的屈折规则，输出每条规则的结果和详细日志。

---

## 4. 翻译沙盒 (Sandbox)

交互式翻译和标注工作台，支持两种模式。

### 4.1 标签屈折模式 (Gloss Mode)

输入格式为 `gloss-TAG1-TAG2` 的文本（如 `star-PL shine-PAST in void`）：

1. 按 gloss 从词典查找对应词条
2. 按标签自动应用屈折规则
3. 生成 IPA
4. 输出跨行标注表（造语词形 / gloss 标签 / IPA）

### 4.2 句法重排模式 (Syntax Mode)

1. 添加 token 并标注句法角色（S / V / O / Mod / Adp / Other）
2. 按语法设置的语序自动重排
3. 自动推断屈折标签（如 S → NOM, O → ACC）
4. 应用屈折后输出跨行标注

### 4.3 词形助手

输入测试词 + 选择词性 + 选择维度值 → 实时预览屈折结果和 IPA。

---

## 5. 造词生成器 (Word Generator)

基于音位配列规则随机生成候选词汇。

| 功能 | 说明 |
|------|------|
| 生成参数 | 数量（1~200）、最小/最大音节数 |
| 音节结构 | 自动读取音位配列设置，展开可选项 |
| 黑名单过滤 | 排除违反音位配列规则的生成词 |
| Swadesh 配对 | 将生成词自动映射到 Swadesh 100 基本词汇表 |
| 改写规则 | 后处理正则替换（如 `aa → ā`） |
| 衰减系数 | 滑块控制各音素类的分布权重（0.0~3.0） |
| IPA 预览 | 每个候选词自动计算 IPA |
| 候选表 | 全选/单选、编辑词性、删除 |
| 导入词典 | 选中候选词一键导入 |

---

## 6. 词典质检 (Quality Check)

对词典全量词条执行 6 条自动化检查规则：

| 规则 | 严重度 | 说明 |
|------|--------|------|
| 缺少词性 | 🔴 错误 | 义项未设置词性 |
| 未映射拼写 | 🟡 警告 | 拼写含不在罗马音映射表中的字符 |
| IPA 为空 | 🟡 警告 | 词条没有 IPA 音标 |
| 词形模式不匹配 | 🟡 警告 | 词形不满足词性的正则模式 |
| 缺少必填字段 | 🔴 错误 | 缺少词性要求的必填字段 |
| 重复词形 | 🟡 警告 | 词典中存在重复的罗马音拼写 |

- 每条规则可独立启用/禁用
- 单条问题可标记为「例外」
- 点击词条名称可跳转到词典编辑器

---

## 7. 统计报告 (Statistics)

自动计算并可视化语言的统计数据：

- **词条总数**：醒目的大号数字
- **词性分布**：水平条形图，按词性分组
- **音素频率**：柱状图，展示出现频率最高的 30 个 IPA 音素
- **字符频率**：柱状图，展示出现频率最高的 30 个罗马音字符
- **二元组合 (Bigram)**：热力图标签，展示最常见的 40 个双音素组合
- **音节结构分布**：柱状图，按音节数分布
- **正字法速查表**：完整的罗马音 → IPA 映射列表

---

## 8. 历时音变引擎 (SCA)

定义和预览历时音变规则，模拟语言的历史演变。

### 8.1 字符模式

| 字段 | 说明 | 示例 |
|------|------|------|
| 目标 (Target) | 要替换的音素/字符（空格分隔） | `p t k` |
| 替换 (Replacement) | 替换为的音素/字符 | `b d g` |
| 前置环境 | 目标前面必须匹配的内容 | `V`（元音宏） |
| 后置环境 | 目标后面必须匹配的内容 | `V` |
| 例外 | 不应用此规则的词 | — |

支持宏展开：`V` 自动展开为元音列表，`C` 展开为辅音列表。

### 8.2 特征模式

- **目标特征**：用 `+`/`-` 指定目标音素特征（如 `[+voiced, -stop]`）
- **替换特征**：指定要设置/移除的特征
- **音素匹配**：实时显示匹配指定特征的所有音素
- **Jaccard 相似度**：特征替换后自动寻找最接近的 IPA 音素
- **特征倒排索引**：O(1) 查询加速

### 8.3 预览功能

- **单词测试**：输入单词 → 实时查看音变结果 + 逐步日志
- **批量预览**：对词典全量词条预览音变结果（前 100 个）
- **应用到词典**：一键将音变结果写回所有受影响的词条

---

## 9. 语料库 (Corpus)

以侧边栏 + 编辑面板的分栏布局管理造语文本和莱比锡标注。

### 9.1 文本管理

- 创建/编辑/删除语料文本
- 元数据：标题、描述、标签、时间戳
- 原始文本（造语原文）和自由翻译

### 9.2 行间标注 (Glossing)

符合莱比锡标注规范的行间注释：

- **自动标注**：原始文本 → 按句拆分 → 按空格分词 → 从词典自动匹配
- **手动编辑**：每个 token 可独立编辑
  - 表层形式 (Surface form)
  - 语素切分 (Morpheme break)
  - 释义标签 (Gloss labels)
  - 关联词条 ID
  - IPA 音标

### 9.3 词典联动

token 关联词条后，悬浮显示词条详细信息（词性、释义、IPA）。

---

## 10. 语系树 (Family Tree)

管理语言的谱系关系，从一个原始语言派生出子语言树。

### 10.1 拓扑可视化

树形结构展示所有语言，高亮当前活动语言，点击节点切换。

### 10.2 派生语言 (Fork)

从父语言创建子语言，完整复制父语言的所有数据（音系、语法、词典、SCA、语料），作为独立副本进行修改。

### 10.3 拉取同步 (Pull Sync)

检查父语言中新增的、子语言中尚不存在的词条：

- **拉取并应用音变**：新词自动经过 SCA 规则集处理，标记为「演变(Evolved)」来源
- 完整保留词源链（parent_entry_id + applied_sound_changes）

### 10.4 借词 (Borrowing)

从任意其他语言借入词汇：

- 选择源语言 → 浏览/搜索其词典
- 一键借入，自动标记为「借词(Borrowed)」来源

---

## 11. 导出与导入 (Export & Import)

### 11.1 导出格式

| 格式 | 内容 | 说明 |
|------|------|------|
| **PDF** | 完整语言参考文档 | 封面、正字法、屈折范式、语法手册、词典 |
| **Excel** | 多 Sheet 工作簿 | 音素表、罗马音映射、完整词典 |
| **Hunspell (.dic/.aff)** | 拼写检查词典 | 含基础形式 + 所有屈折变位形式 |
| **CSV** | 词典表格 | Unicode BOM 头，Excel 中文兼容 |
| **LLM Prompt (.md)** | AI 对话 Prompt | 完整语言描述 Markdown + 5 个建议问题 |

### 11.2 导入

- **CSV 导入**：自动检测格式（PolyGlot / Vulgarlang / 通用格式）
- 自动列映射（word / ipa / pos / gloss / definition）
- POS 自动标准化
- 预览确认后批量导入

### 11.3 LLM Prompt

生成包含完整语言描述的 Markdown 文件，可直接提交给 AI 助手使用：

- 复制到剪贴板
- 下载为 `.md` 文件
- 内含 5 个推荐 Prompt 问题

---

## 12. 快速录入 (Quick Entry)

底部导航栏常驻快捷按钮，打开弹窗快速录入词条：

- 输入字段：单词（罗马音）、释义、词性
- **快捷键**：Tab 切换字段 → Enter 保存并清空 → Esc 关闭
- 自动 IPA 生成
- 已保存计数器

---

## 附录：多语言工作区

Conlang Maker 支持在同一项目下管理多个语言：

- **语言切换器**：左上角下拉菜单切换活动语言
- **独立数据**：每个语言拥有独立的音系、语法、词典、SCA、语料数据
- **谱系关系**：语言间通过 parent_id 建立谱系树
- **语言间操作**：拉取同步、借词等跨语言功能

## 附录：支持的预设语言风格

| 预设 | 特点 |
|------|------|
| 日语风 | (C)V 音节，无辅音尾 |
| 阿拉伯语风 | 丰富的咽音/小舌音 |
| 斯拉夫语风 | 复杂辅音簇 |
| 芬兰语风 | 元音和谐 |
| 夏威夷语风 | 极少辅音，CV 为主 |
| 纳瓦特尔语风 | 塞擦音丰富 |
| 普通话风 | 送气对立 + 声调 |
| 印地语风 | 卷舌 + 送气对立 |
| 斯瓦希里语风 | 前鼻化辅音 |
| 拉丁语风 | 经典印欧语系 |
| 格鲁吉亚语风 | 挤喉音 |
| 精灵语风 | 流音丰富，柔和 |
